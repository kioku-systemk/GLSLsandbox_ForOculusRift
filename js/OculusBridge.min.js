/*! OculusBridge 2014-01-27 */
var OculusBridge=function(a){var b,c=null,d=!0,e=a.hasOwnProperty("address")?a.address:"localhost",f=a.hasOwnProperty("port")?a.port:9005,g=a.hasOwnProperty("retryInterval")?a.retryInterval:1,h=a.hasOwnProperty("debug")?a.debug:!1,i={x:0,y:0,z:0,w:0},j={FOV:125.871,hScreenSize:.14976,vScreenSize:.0935,vScreenCenter:.04675,eyeToScreenDistance:.041,lensSeparationDistance:.067,interpupillaryDistance:.0675,hResolution:1280,vResolution:720,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]},k={onOrientationUpdate:null,onConfigUpdate:null,onConnect:null,onDisconnect:null};for(var l in k)"function"==typeof a[l]&&(k[l]=a[l]);var m=function(a){a.o&&4==a.o.length&&(i.x=Number(a.o[1]),i.y=Number(a.o[2]),i.z=Number(a.o[3]),i.w=Number(a.o[0]),k.onOrientationUpdate&&k.onOrientationUpdate(i))},n=function(a){j.hScreenSize=a.screenSize[0],j.vScreenSize=a.screenSize[1],j.vScreenCenter=a.screenSize[1]/2,j.eyeToScreenDistance=a.eyeToScreen,j.lensSeparationDistance=a.lensDistance,j.interpupillaryDistance=a.interpupillaryDistance,j.hResolution=a.screenResolution[0],j.vResolution=a.screenResolution[1],j.distortionK=[a.distortion[0],a.distortion[1],a.distortion[2],a.distortion[3]],j.FOV=a.fov,k.onConfigUpdate&&k.onConfigUpdate(j)},o=function(){d=!0;var a="ws://"+e+":"+f+"/";b=new WebSocket(a),p("Attempting to connect: "+a),b.onopen=function(){p("Connected!"),k.onConnect&&k.onConnect()},b.onerror=function(){p("Socket error.")},b.onmessage=function(a){var b=JSON.parse(a.data),c=b.m;switch(c){case"config":n(b);break;case"orientation":m(b);break;default:p("Unknown message received from server: "+a.data),r()}},b.onclose=function(){k.onDisconnect&&k.onDisconnect(),d&&(p("Connection failed, retrying in 1 second..."),c=window.setTimeout(q,1e3*g))}},p=function(a){h&&console.log("OculusBridge: "+a)},q=function(){o()},r=function(){d=!1,window.clearTimeout(c),b.close()},s=function(){return j},t=function(){return i},u=function(){return 1==b.readyState};return{isConnected:u,disconnect:r,connect:o,getOrientation:t,getConfiguration:s}};